#include "reg52.h"

typedef unsigned int u16;
typedef unsigned char u8;

//定义案件控制引脚，低电平表示被按下
sbit KEY1=P3^1;
sbit KEY2=P3^0;
sbit KEY3=P3^2;
sbit KEY4=P3^3;

//定义LED控制引脚，低电平亮
sbit LED1=P2^0;

#define KEY1_PRESS 1
#define KEY2_PRESS 2
#define KEY3_PRESS 3
#define KEY4_PRESS 4
#define KEY_UNPRESS 0

//延时函数
void delay(u16 j)
{
	while(j--);
}

/*
函数功能：扫描按键是否被按下
函数输入：mode=1函数连续扫描
          mode=0函数单次扫描
函数输出：KEY1_PRESS被按下
					KEY2_PRESS被按下
					KEY3_PRESS被按下
					KEY4_PRESS被按下
					KEY_UNPRESS无按键被按下
*/
u8 key_scan(u8 mode)
{
	static u8 key=1;//为1时表示没有按键被按下，0时表示按键已被按下
	
	if(mode)
	{
		key=1;
	}
	
	if(key==1&&(KEY1==0||KEY2==0||KEY3==0||KEY4==0))
	{
		delay(1000);
		key=0;
		
		if(KEY1==0)
		{
			return KEY1_PRESS;
		}
		if(KEY2==0)
		{
			return KEY2_PRESS;
		}
		if(KEY3==0)
		{
			return KEY3_PRESS;
		}
		if(KEY4==0)
		{
			return KEY4_PRESS;
		}
	}
	else if(KEY1==1&&KEY2==1&&KEY3==1&&KEY4==1)
	{
		key=1;
	}
	return KEY_UNPRESS;//把一直按下某个按键的状态也返回未被按下
}

void main()
{
	u8 key=0;
	while(1)
	{
		key=key_scan(1);
		if(key==KEY1_PRESS)
		{
			LED1=!LED1;
		}
	}
}
